<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LUNSERK SACCO Admin{% endblock %}</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        :root {
            --primary-blue: #2563eb;
            --secondary-blue: #3b82f6;
            --accent-blue: #60a5fa;
            --dark-blue: #1e40af;
            --light-blue: #dbeafe;
            --white: #ffffff;
            --light-gray: #f8fafc;
            --gray: #64748b;
            --dark-gray: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --purple: #8b5cf6;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        }
        
        .sidebar-gradient {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
        }
        
        .sidebar-item {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            border-radius: 0.75rem;
            margin-bottom: 0.25rem;
        }
        
        .sidebar-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--primary-blue);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .sidebar-item:hover::before {
            transform: scaleY(1);
        }
        
        .sidebar-item.active::before {
            transform: scaleY(1);
        }
        
        .sidebar-item.active {
            background: rgba(37, 99, 235, 0.1);
        }
        
        .sidebar-subitem {
            transition: all 0.2s ease;
            border-radius: 0.5rem;
            margin-left: 1rem;
        }
        
        .sidebar-subitem:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }
        
        .card-glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: rgba(37, 99, 235, 0.5) transparent;
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: rgba(37, 99, 235, 0.5);
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background-color: rgba(37, 99, 235, 0.8);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .border-gradient {
            border: 2px solid transparent;
            background: linear-gradient(var(--light-gray), var(--light-gray)) padding-box,
                        linear-gradient(135deg, var(--primary-blue) 0%, var(--purple) 100%) border-box;
        }
        
        .badge-pulse {
            animation: badge-pulse 2s ease-in-out infinite;
        }
        
        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .nav-blur {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        /* Mobile Menu Styles */
        .mobile-sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
        }
        
        .mobile-sidebar.open {
            transform: translateX(0);
        }
        
        .mobile-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 40;
        }
        
        .mobile-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        /* Rotate animation for dropdown arrows */
        .rotate-180 {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay fixed inset-0 bg-black bg-opacity-50 lg:hidden"></div>
    
   <!-- Mobile Sidebar -->
   <aside id="mobile-sidebar" class="mobile-sidebar sidebar-gradient text-white w-64 min-h-screen fixed lg:hidden">
    <!-- Mobile header with close button -->
    <div class="p-6 border-b border-gray-800 flex justify-between items-center">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                <img src="https://i.ibb.co/CxNVLMr/Gemini-Generated-Image-7j13hc7j13hc7j13-modified.png" 
                     alt="LUNSERK Logo" 
                     class="w-6 h-6 object-contain">
            </div>
            <div>
                <h1 class="text-lg font-bold">LUNSERK SACCO</h1>
                <p class="text-xs opacity-90">Admin Portal</p>
            </div>
        </div>
        <button id="close-mobile-menu" class="text-white hover:text-gray-300">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>
    
    <!-- Mobile User Info -->
    <div class="p-4 border-b border-gray-800">
        <div class="flex items-center space-x-3">
            <div class="relative">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                    {{ session.get('admin_name', 'A')[0] if session.get('admin_name') else 'A' }}
                </div>
                <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-gray-900"></div>
            </div>
            <div class="flex-1 min-w-0">
                <p class="text-sm font-medium truncate">{{ session.get('admin_name', 'Administrator') }}</p>
                <p class="text-xs opacity-90 truncate">{{ session.get('admin_role', 'Super Admin') }}</p>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="p-4 scrollbar-thin" style="max-height: calc(100vh - 140px); overflow-y: auto;">
        <nav class="space-y-1">
            <!-- Dashboard -->
            <a href="{{ url_for('admin_dashboard') }}" 
               class="sidebar-item flex items-center px-4 py-3 hover-lift group">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-blue-500/20 to-blue-500/10 flex items-center justify-center mr-3">
                    <i class="fas fa-tachometer-alt text-blue-400 text-sm"></i>
                </div>
                <span class="font-medium">Dashboard</span>
            </a>

            <!-- Members Management -->
            <div class="sidebar-item">
                <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleMobileSubmenu('mobile-members')">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-green-500/20 to-green-500/10 flex items-center justify-center mr-3">
                            <i class="fas fa-users text-green-400 text-sm"></i>
                        </div>
                        <span class="font-medium">Members</span>
                    </div>
                    <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="mobile-members-arrow"></i>
                </div>
                <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="mobile-members-submenu">
                    <a href="{{url_for('members.add_member')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-user-plus text-green-400 mr-2 text-xs"></i>
                        Add Member
                    </a>
                    <a href="{{ url_for('members.members_list') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-list text-green-400 mr-2 text-xs"></i>
                        All Members
                    </a>
                    <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-chart-bar text-green-400 mr-2 text-xs"></i>
                        Reports
                    </a>
                </div>
            </div>

            <!-- Savings -->
            <div class="sidebar-item">
                <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleMobileSubmenu('mobile-savings')">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-yellow-500/20 to-yellow-500/10 flex items-center justify-center mr-3">
                            <i class="fas fa-piggy-bank text-yellow-400 text-sm"></i>
                        </div>
                        <span class="font-medium">Savings</span>
                    </div>
                    <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="mobile-savings-arrow"></i>
                </div>
                <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="mobile-savings-submenu">
                    <a href="{{url_for('savings.accounts')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-wallet text-yellow-400 mr-2 text-xs"></i>
                        Accounts
                    </a>
                    <a href="{{url_for('savings.deposits')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-hand-holding-usd text-yellow-400 mr-2 text-xs"></i>
                        Deposits
                    </a>
                    <a href="{{url_for('savings.withdrawals')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-money-check-alt text-yellow-400 mr-2 text-xs"></i>
                        Withdrawals
                    </a>
                </div>
            </div>

            <!-- Loans -->
            <div class="sidebar-item">
                <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleMobileSubmenu('mobile-loans')">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-red-500/20 to-red-500/10 flex items-center justify-center mr-3">
                            <i class="fas fa-hand-holding-usd text-red-400 text-sm"></i>
                        </div>
                        <span class="font-medium">Loans</span>
                    </div>
                    <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="mobile-loans-arrow"></i>
                </div>
                <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="mobile-loans-submenu">
                    <a href="{{ url_for('loans.loan_products') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-boxes text-red-400 mr-2 text-xs"></i>
                        Products
                    </a>
                    <a href="{{ url_for('loans.loan_applications') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-file-alt text-red-400 mr-2 text-xs"></i>
                        Applications
                    </a>
                    <a href="{{url_for('loans.loan_accounts')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-landmark text-red-400 mr-2 text-xs"></i>
                        Loan Accounts
                    </a>
                    <a href="{{ url_for('loans.direct_loan') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-plus-circle text-red-400 mr-2 text-xs"></i>
                        Direct Loan
                    </a>
                    <a href="{{ url_for('loans.loan_repayments') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-history text-red-400 mr-2 text-xs"></i>
                        Repayments
                    </a>
                </div>
            </div>

            <!-- Expenses & Incomes -->
            <a href="{{ url_for('expense_incomes.dashboard') }}" 
               class="sidebar-item flex items-center px-4 py-3 hover-lift group">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-purple-500/20 to-purple-500/10 flex items-center justify-center mr-3">
                    <i class="fas fa-exchange-alt text-purple-400 text-sm"></i>
                </div>
                <span class="font-medium">Expenses & Incomes</span>
            </a>

            <!-- Manage Shares -->
            <a href="{{ url_for('shares_admin.manage_shares') }}" 
               class="sidebar-item flex items-center px-4 py-3 hover-lift group">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-indigo-500/20 to-indigo-500/10 flex items-center justify-center mr-3">
                    <i class="fas fa-chart-pie text-indigo-400 text-sm"></i>
                </div>
                <span class="font-medium">Manage Shares</span>
            </a>

            <!-- Reports
            <div class="sidebar-item">
                <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleMobileSubmenu('mobile-reports')">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-cyan-500/20 to-cyan-500/10 flex items-center justify-center mr-3">
                            <i class="fas fa-chart-line text-cyan-400 text-sm"></i>
                        </div>
                        <span class="font-medium">Reports</span>
                    </div>
                    <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="mobile-reports-arrow"></i>
                </div>
                <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="mobile-reports-submenu">
                    <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-balance-scale text-cyan-400 mr-2 text-xs"></i>
                        Financial
                    </a>
                    <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-user-chart text-cyan-400 mr-2 text-xs"></i>
                        Analytics
                    </a>
                    <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-print text-cyan-400 mr-2 text-xs"></i>
                        Print Reports
                    </a>
                </div>
            </div> -->

            <!-- Settings 
            <div class="sidebar-item">
                <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleMobileSubmenu('mobile-settings')">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-gray-500/20 to-gray-500/10 flex items-center justify-center mr-3">
                            <i class="fas fa-cog text-gray-400 text-sm"></i>
                        </div>
                        <span class="font-medium">Settings</span>
                    </div>
                    <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="mobile-settings-arrow"></i>
                </div>
                <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="mobile-settings-submenu">
                    <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-user-shield text-gray-400 mr-2 text-xs"></i>
                        Users & Roles
                    </a>
                    <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-sliders-h text-gray-400 mr-2 text-xs"></i>
                        System
                    </a>
                    <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                        <i class="fas fa-envelope text-gray-400 mr-2 text-xs"></i>
                        Email
                    </a>
                </div>
            </div>-->

            <!-- Mobile Logout -->
            <a href="{{ url_for('adminauth.admin_logout') }}" 
               class="sidebar-item flex items-center px-4 py-3 hover-lift group"
               onclick="return confirm('Are you sure you want to logout?')">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-red-500/20 to-red-500/10 flex items-center justify-center mr-3">
                    <i class="fas fa-sign-out-alt text-red-400 text-sm"></i>
                </div>
                <span class="font-medium">Logout</span>
            </a>
        </nav>
    </div>
</aside>


    <!-- Desktop Sidebar -->
    <aside class="sidebar-gradient text-white w-64 min-h-screen fixed hidden lg:block z-30">
        <!-- Logo Header -->
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg">
                        <img src="https://i.ibb.co/CxNVLMr/Gemini-Generated-Image-7j13hc7j13hc7j13-modified.png" 
                             alt="LUNSERK Logo" 
                             class="w-8 h-8 object-contain">
                    </div>
                    <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-900"></div>
                </div>
                <div>
                    <h1 class="text-lg font-bold tracking-tight">LUNSERK SACCO</h1>
                    <p class="text-xs opacity-90 mt-1">Admin Portal</p>
                </div>
            </div>
        </div>

        <!-- User Quick Info -->
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                        {{ session.get('admin_name', 'A')[0] if session.get('admin_name') else 'A' }}
                    </div>
                    <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-gray-900"></div>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium truncate">{{ session.get('admin_name', 'Administrator') }}</p>
                    <p class="text-xs opacity-90 truncate">{{ session.get('admin_role', 'Super Admin') }}</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <div class="p-4 scrollbar-thin" style="max-height: calc(100vh - 220px); overflow-y: auto;">
            <nav class="space-y-1">
                <!-- Dashboard -->
                <a href="{{ url_for('admin_dashboard') }}" 
                   class="sidebar-item flex items-center px-4 py-3 hover-lift group {% if request.endpoint == 'admin_dashboard' %}active{% endif %}">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-blue-500/20 to-blue-500/10 flex items-center justify-center mr-3 group-hover:from-blue-500/30 group-hover:to-blue-500/20 transition-all">
                        <i class="fas fa-tachometer-alt text-blue-400 text-sm"></i>
                    </div>
                    <span class="font-medium">Dashboard</span>
                    <span class="ml-auto bg-blue-500 text-xs rounded-full h-5 w-5 flex items-center justify-center">5</span>
                </a>

                <!-- Members Management -->
                <div class="sidebar-item">
                    <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleSubmenu('members')">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-green-500/20 to-green-500/10 flex items-center justify-center mr-3">
                                <i class="fas fa-users text-green-400 text-sm"></i>
                            </div>
                            <span class="font-medium">Members</span>
                        </div>
                        <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="members-arrow"></i>
                    </div>
                    <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="members-submenu">
                        <a href="{{url_for('members.add_member')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-user-plus text-green-400 mr-2 text-xs"></i>
                            Add Member
                        </a>
                        <a href="{{ url_for('members.members_list') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-list text-green-400 mr-2 text-xs"></i>
                            All Members
                        </a>
                        <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-chart-bar text-green-400 mr-2 text-xs"></i>
                            Reports
                        </a>
                    </div>
                </div>

                <!-- Savings -->
                <div class="sidebar-item">
                    <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleSubmenu('savings')">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-yellow-500/20 to-yellow-500/10 flex items-center justify-center mr-3">
                                <i class="fas fa-piggy-bank text-yellow-400 text-sm"></i>
                            </div>
                            <span class="font-medium">Savings</span>
                        </div>
                        <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="savings-arrow"></i>
                    </div>
                    <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="savings-submenu">
                        <a href="{{url_for('savings.accounts')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-wallet text-yellow-400 mr-2 text-xs"></i>
                            Accounts
                        </a>
                        <a href="{{url_for('savings.deposits')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-hand-holding-usd text-yellow-400 mr-2 text-xs"></i>
                            Deposits
                        </a>
                        <a href="{{url_for('savings.withdrawals')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-money-check-alt text-yellow-400 mr-2 text-xs"></i>
                            Withdrawals
                        </a>
                    </div>
                </div>

                <!-- Loans Section -->
                    <div class="sidebar-item">
                        <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleSubmenu('loans')">
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-red-500/20 to-red-500/10 flex items-center justify-center mr-3">
                                    <i class="fas fa-hand-holding-usd text-red-400 text-sm"></i>
                                </div>
                                <span class="font-medium">Loans</span>
                            </div>
                            <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="loans-arrow"></i>
                        </div>
                        <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="loans-submenu">
                            <a href="{{ url_for('loans.loan_products') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                                <i class="fas fa-boxes text-red-400 mr-2 text-xs"></i>
                                Products
                            </a>
                            <a href="{{ url_for('loans.loan_applications') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                                <i class="fas fa-file-alt text-red-400 mr-2 text-xs"></i>
                                Applications
                            </a>
                            <a href="{{url_for('loans.loan_accounts')}}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                                <i class="fas fa-landmark text-red-400 mr-2 text-xs"></i>
                                Loan Accounts
                            </a>
                            <a href="{{ url_for('loans.direct_loan') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                                <i class="fas fa-plus-circle text-red-400 mr-2 text-xs"></i>
                                Direct Loan
                            </a>
                            <a href="{{ url_for('loans.loan_repayments') }}" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                                <i class="fas fa-history text-red-400 mr-2 text-xs"></i>
                                Repayments
                            </a>
                        </div>
                    </div>

                <!-- Transactions -->
              <!-- Update your sidebar link -->
                <a href="{{ url_for('expense_incomes.dashboard') }}" class="sidebar-item flex items-center px-4 py-3 hover-lift group">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-purple-500/20 to-purple-500/10 flex items-center justify-center mr-3 group-hover:from-purple-500/30 group-hover:to-purple-500/20 transition-all">
                        <i class="fas fa-exchange-alt text-purple-400 text-sm"></i>
                    </div>
                    <span class="font-medium">Expenses & Incomes</span>
                    <!-- You can add dynamic count if needed -->
                    <!-- <span class="ml-auto bg-purple-500 text-xs rounded-full h-5 w-5 flex items-center justify-center">{{ pending_count }}</span> -->
                </a>

                <a href="{{ url_for('shares_admin.manage_shares') }}" class="sidebar-item flex items-center px-4 py-3 hover-lift group">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-purple-500/20 to-purple-500/10 flex items-center justify-center mr-3 group-hover:from-purple-500/30 group-hover:to-purple-500/20 transition-all">
                        <i class="fas fa-exchange-alt text-purple-400 text-sm"></i>
                    </div>
                    <span class="font-medium">Manage Shares</span>
                    <!-- You can add dynamic count if needed -->
                    <!-- <span class="ml-auto bg-purple-500 text-xs rounded-full h-5 w-5 flex items-center justify-center">{{ pending_count }}</span> -->
                </a>

                <!-- Reports 
                <div class="sidebar-item">
                    <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleSubmenu('reports')">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-cyan-500/20 to-cyan-500/10 flex items-center justify-center mr-3">
                                <i class="fas fa-chart-line text-cyan-400 text-sm"></i>
                            </div>
                            <span class="font-medium">Reports</span>
                        </div>
                        <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="reports-arrow"></i>
                    </div>
                    <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="reports-submenu">
                        <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-balance-scale text-cyan-400 mr-2 text-xs"></i>
                            Financial
                        </a>
                        <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-user-chart text-cyan-400 mr-2 text-xs"></i>
                            Analytics
                        </a>
                        <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-print text-cyan-400 mr-2 text-xs"></i>
                            Print Reports
                        </a>
                    </div>
                </div>-->

                <!-- Settings 
                <div class="sidebar-item">
                    <div class="flex items-center justify-between px-4 py-3 cursor-pointer hover-lift" onclick="toggleSubmenu('settings')">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-gray-500/20 to-gray-500/10 flex items-center justify-center mr-3">
                                <i class="fas fa-cog text-gray-400 text-sm"></i>
                            </div>
                            <span class="font-medium">Settings</span>
                        </div>
                        <i class="fas fa-chevron-down text-xs transition-transform duration-300" id="settings-arrow"></i>
                    </div>
                    <div class="sidebar-submenu hidden pl-12 pr-4 py-2 space-y-2 mt-1" id="settings-submenu">
                        <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-user-shield text-gray-400 mr-2 text-xs"></i>
                            Users & Roles
                        </a>
                        <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-sliders-h text-gray-400 mr-2 text-xs"></i>
                            System
                        </a>
                        <a href="#" class="sidebar-subitem flex items-center py-2 px-3 text-sm">
                            <i class="fas fa-envelope text-gray-400 mr-2 text-xs"></i>
                            Email
                        </a>
                    </div>
                </div>
            </nav>-->

            <!-- System Status
            <div class="mt-8 p-4 bg-gray-800/50 rounded-xl">
                <p class="text-xs uppercase tracking-wider text-gray-400 mb-3">System Status</p>
                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-sm">Server Load</span>
                            <span class="text-green-400 text-sm font-medium">24%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-gradient-to-r from-green-500 to-green-400 h-2 rounded-full" style="width: 24%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Database</span>
                        <span class="flex items-center text-green-400 text-sm font-medium">
                            <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                            Online
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Uptime</span>
                        <span class="text-green-400 text-sm font-medium">99.8%</span>
                    </div>
                </div>
            </div>
        </div> -->

        <!-- Logout Button -->
        <div class="absolute bottom-0 w-full p-4 border-t border-gray-800">
            <a href="{{ url_for('adminauth.admin_logout') }}" 
               class="flex items-center justify-center px-4 py-3 bg-gradient-to-r from-red-500/20 to-red-500/10 hover:from-red-500/30 hover:to-red-500/20 rounded-xl transition-all group"
               onclick="return confirm('Are you sure you want to logout?')">
                <i class="fas fa-sign-out-alt text-red-400 mr-2 group-hover:text-red-300"></i>
                <span class="font-medium">Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="lg:ml-64 flex-1 min-h-screen flex flex-col">
        <!-- Top Navigation Bar -->
        <nav class="nav-blur shadow-lg py-3 px-4 md:px-6 sticky top-0 z-20">
            <div class="flex items-center justify-between">
                <!-- Left: Mobile menu and breadcrumb -->
                <div class="flex items-center space-x-4">
                    <!-- Mobile menu button -->
                    <button id="mobile-menu-btn" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-bars text-gray-700 text-xl"></i>
                    </button>
                    
                    <!-- Breadcrumb -->
                    <div class="hidden md:flex items-center space-x-2 text-sm">
                        <a href="{{ url_for('admin_dashboard') }}" class="text-gray-500 hover:text-blue-600 transition-colors">
                            <i class="fas fa-home"></i>
                        </a>
                        <span class="text-gray-300">/</span>
                        <span class="text-gray-700 font-medium">{% block breadcrumb %}Dashboard{% endblock %}</span>
                    </div>
                </div>
                
                <!-- Right: Search, notifications, and user info -->
                <div class="flex items-center space-x-3 md:space-x-4">
                    <!-- Mobile search button -->
                    <button onclick="toggleMobileSearch()" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-search text-gray-700"></i>
                    </button>
                    
                    <!-- Desktop Search -->
                    <div class="hidden lg:block relative">
                        <div class="relative">
                            <input type="text" 
                                   placeholder="Search members, transactions..." 
                                   class="pl-10 pr-4 py-2 w-64 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   id="global-search">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="relative">
                        <button onclick="toggleNotifications()" 
                                class="relative p-2 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="fas fa-bell text-gray-700 text-xl"></i>
                            <span class="badge-pulse absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
                                3
                            </span>
                        </button>
                        
                        <!-- Notifications Dropdown -->
                        <div id="notifications-dropdown" 
                             class="hidden absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 z-50">
                            <div class="p-4 border-b">
                                <div class="flex justify-between items-center">
                                    <h3 class="font-bold text-gray-800">Notifications</h3>
                                    <a href="#" class="text-blue-600 text-sm hover:text-blue-800">
                                        Mark all read
                                    </a>
                                </div>
                            </div>
                            <div class="max-h-96 overflow-y-auto">
                                <!-- Notification items -->
                                <div class="p-4 border-b hover:bg-gray-50 cursor-pointer">
                                    <div class="flex items-start">
                                        <div class="bg-blue-100 p-2 rounded-full mr-3">
                                            <i class="fas fa-user-plus text-blue-600"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="font-medium text-gray-800">New Member Registered</p>
                                            <p class="text-sm text-gray-600">John Doe joined the SACCO</p>
                                            <p class="text-xs text-gray-500 mt-1">2 minutes ago</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 border-t">
                                <a href="#" class="text-center block text-blue-600 hover:text-blue-800 font-medium text-sm">
                                    View all notifications
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats (Desktop) -->
                    <div class="hidden lg:flex items-center space-x-4">
                        <div class="text-center">
                            <p class="text-xs text-gray-600">Members</p>
                            <p class="font-bold text-gray-800">5</p>
                        </div>
                        <div class="h-8 w-px bg-gray-300"></div>
                        <div class="text-center">
                            <p class="text-xs text-gray-600">Loans</p>
                            <p class="font-bold text-gray-800">3</p>
                        </div>
                    </div>
                    
                    <!-- User Profile Dropdown -->
                    <div class="relative">
                        <button onclick="toggleUserMenu()" 
                                class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="hidden md:block text-right">
                                <p class="text-sm font-medium text-gray-800">{{ session.get('admin_name', 'Admin').split(' ')[0] if session.get('admin_name') else 'Admin' }}</p>
                                <p class="text-xs text-gray-600">{{ session.get('admin_role', 'Admin') }}</p>
                            </div>
                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-bold">
                                {{ session.get('admin_name', 'A')[0] if session.get('admin_name') else 'A' }}
                            </div>
                            <i class="fas fa-chevron-down text-gray-600 text-xs hidden md:block"></i>
                        </button>
                        
                        <!-- User Menu Dropdown -->
                        <div id="user-menu-dropdown" 
                             class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-200 z-50">
                            <div class="p-3 border-b">
                                <p class="font-medium text-gray-800">Quick Actions</p>
                            </div>
                            <div class="py-2">
                                <a href="#" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-50 text-sm">
                                    <i class="fas fa-user mr-3 text-gray-500"></i>
                                    My Profile
                                </a>
                                <a href="#" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-50 text-sm">
                                    <i class="fas fa-key mr-3 text-gray-500"></i>
                                    Change Password
                                </a>
                                <div class="border-t border-gray-200 my-2"></div>
                                <a href="{{ url_for('adminauth.admin_logout') }}" 
                                   class="flex items-center px-4 py-2 text-red-600 hover:bg-red-50 text-sm"
                                   onclick="return confirm('Are you sure you want to logout?')">
                                    <i class="fas fa-sign-out-alt mr-3"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Search Bar -->
            <div id="mobile-search" class="mt-3 hidden lg:hidden">
                <div class="relative">
                    <input type="text" 
                           placeholder="Search..." 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-6">
            <!-- Page Header -->
            <div class="mb-6 fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">{% block page_title %}Dashboard{% endblock %}</h1>
                        <p class="text-gray-600 mt-1 text-sm md:text-base">{% block page_subtitle %}Welcome to LUNSERK SACCO Admin Panel{% endblock %}</p>
                    </div>
                    <div class="mt-4 md:mt-0">
                        {% block page_actions %}
                        <div class="flex flex-wrap gap-2">
                            <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors text-sm md:text-base">
                                <i class="fas fa-download mr-2"></i>Export
                            </button>
                            <button class="px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all text-sm md:text-base">
                                <i class="fas fa-plus mr-2"></i>Add New
                            </button>
                        </div>
                        {% endblock %}
                    </div>
                </div>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="mb-6 p-4 rounded-xl border-l-4 animate__animated animate__fadeInRight shadow-sm
                            {% if category == 'success' %}bg-green-50 border-green-500 text-green-700
                            {% elif category == 'error' %}bg-red-50 border-red-500 text-red-700
                            {% elif category == 'warning' %}bg-yellow-50 border-yellow-500 text-yellow-700
                            {% elif category == 'info' %}bg-blue-50 border-blue-500 text-blue-700
                            {% else %}bg-gray-50 border-gray-500 text-gray-700{% endif %}">
                            <div class="flex items-center">
                                <i class="fas 
                                    {% if category == 'success' %}fa-check-circle
                                    {% elif category == 'error' %}fa-exclamation-circle
                                    {% elif category == 'warning' %}fa-exclamation-triangle
                                    {% else %}fa-info-circle{% endif %} 
                                    mr-3 text-lg"></i>
                                <div class="flex-1">
                                    <span class="font-medium">{{ message }}</span>
                                    <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                            class="float-right text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Page Content -->
            {% block content %}
            <!-- Default content will be overridden by child templates -->
            <div class="card-glass rounded-2xl p-6 animate__animated animate__fadeIn">
                <div class="text-center py-8">
                    <div class="w-24 h-24 bg-gradient-to-r from-blue-100 to-blue-50 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-tachometer-alt text-blue-500 text-4xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome to Admin Panel</h2>
                    <p class="text-gray-600 mb-6">Select a section from the sidebar to get started</p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="#" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg hover-lift">
                            <i class="fas fa-plus mr-2"></i>Quick Start
                        </a>
                        <a href="#" class="px-6 py-3 border border-blue-500 text-blue-600 rounded-xl hover:bg-blue-50 transition-all hover-lift">
                            <i class="fas fa-book mr-2"></i>View Guide
                        </a>
                    </div>
                </div>
            </div>
            {% endblock %}
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 py-4 md:py-6">
            <div class="container mx-auto px-4 md:px-6">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0 text-center md:text-left">
                        <div class="flex items-center justify-center md:justify-start space-x-3">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                                <img src="https://i.ibb.co/CxNVLMr/Gemini-Generated-Image-7j13hc7j13hc7j13-modified.png" 
                                     alt="LUNSERK Logo" 
                                     class="w-4 h-4 object-contain">
                            </div>
                            <div>
                                <p class="text-sm font-bold text-gray-800">LUNSERK TECHNOLOGIES SACCO</p>
                                <p class="text-xs text-gray-600">Foundation For Your Digital Transformation</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-center md:text-right">
                        <div class="flex items-center justify-center md:justify-end space-x-4">
                            <div class="hidden md:block">
                                <p class="text-xs text-gray-600">Server Time</p>
                                <p class="font-mono text-sm text-gray-800" id="server-time">00:00:00</p>
                            </div>
                            <div class="hidden md:block">
                                <p class="text-xs text-gray-600">Status</p>
                                <p class="text-sm text-green-600 font-medium">System Online</p>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2 md:mt-0">
                            &copy; 2024 LUNSERK SACCO  v1.0.0  
                            <span class="text-green-500">
                                <i class="fas fa-circle text-xs mr-1"></i>
                                Connected
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // Initialize server time
        function updateServerTime() {
            const now = new Date();
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: false 
            };
            
            const timeString = now.toLocaleTimeString('en-US', timeOptions);
            const serverTimeElement = document.getElementById('server-time');
            if (serverTimeElement) {
                serverTimeElement.textContent = timeString;
            }
        }
        
        // Update time every second
        updateServerTime();
        setInterval(updateServerTime, 1000);

        // Mobile menu functions
        function openMobileMenu() {
            document.getElementById('mobile-sidebar').classList.add('open');
            document.getElementById('mobile-overlay').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            document.getElementById('mobile-sidebar').classList.remove('open');
            document.getElementById('mobile-overlay').classList.remove('open');
            document.body.style.overflow = 'auto';
        }

        // Event listeners for mobile menu
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu button
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', openMobileMenu);
            }

            // Close mobile menu button
            const closeMobileMenuBtn = document.getElementById('close-mobile-menu');
            if (closeMobileMenuBtn) {
                closeMobileMenuBtn.addEventListener('click', closeMobileMenu);
            }

            // Close mobile menu when clicking overlay
            const mobileOverlay = document.getElementById('mobile-overlay');
            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', closeMobileMenu);
            }
        });

        // Toggle mobile search
        function toggleMobileSearch() {
            const mobileSearch = document.getElementById('mobile-search');
            if (mobileSearch) {
                mobileSearch.classList.toggle('hidden');
            }
        }

        // Toggle desktop submenus
        function toggleSubmenu(menuId) {
            const submenu = document.getElementById(`${menuId}-submenu`);
            const arrow = document.getElementById(`${menuId}-arrow`);
            
            if (submenu && arrow) {
                submenu.classList.toggle('hidden');
                arrow.classList.toggle('rotate-180');
                
                // Close other submenus
                document.querySelectorAll('.sidebar-submenu').forEach(otherSubmenu => {
                    if (otherSubmenu !== submenu && !otherSubmenu.classList.contains('hidden')) {
                        otherSubmenu.classList.add('hidden');
                        const otherArrow = otherSubmenu.parentElement.querySelector('.fa-chevron-down');
                        if (otherArrow) otherArrow.classList.remove('rotate-180');
                    }
                });
            }
        }

        // Toggle mobile submenus
        function toggleMobileSubmenu(menuId) {
            const submenu = document.getElementById(`${menuId}-submenu`);
            const arrow = document.getElementById(`${menuId}-arrow`);
            
            if (submenu && arrow) {
                submenu.classList.toggle('hidden');
                arrow.classList.toggle('rotate-180');
                
                // Close other mobile submenus
                document.querySelectorAll('.sidebar-submenu').forEach(otherSubmenu => {
                    if (otherSubmenu !== submenu && !otherSubmenu.classList.contains('hidden')) {
                        otherSubmenu.classList.add('hidden');
                        const otherArrow = otherSubmenu.parentElement.querySelector('.fa-chevron-down');
                        if (otherArrow) otherArrow.classList.remove('rotate-180');
                    }
                });
            }
        }

        // Toggle notifications dropdown
        function toggleNotifications() {
            const dropdown = document.getElementById('notifications-dropdown');
            if (dropdown) {
                dropdown.classList.toggle('hidden');
                
                // Close other dropdowns
                const userMenuDropdown = document.getElementById('user-menu-dropdown');
                if (userMenuDropdown) {
                    userMenuDropdown.classList.add('hidden');
                }
            }
        }

        // Toggle user menu dropdown
        function toggleUserMenu() {
            const dropdown = document.getElementById('user-menu-dropdown');
            if (dropdown) {
                dropdown.classList.toggle('hidden');
                
                // Close other dropdowns
                const notificationsDropdown = document.getElementById('notifications-dropdown');
                if (notificationsDropdown) {
                    notificationsDropdown.classList.add('hidden');
                }
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            // Notifications dropdown
            const notificationsBtn = document.querySelector('[onclick="toggleNotifications()"]');
            const notificationsDropdown = document.getElementById('notifications-dropdown');
            
            if (notificationsBtn && notificationsDropdown && 
                !notificationsBtn.contains(event.target) && 
                !notificationsDropdown.contains(event.target)) {
                notificationsDropdown.classList.add('hidden');
            }

            // User menu dropdown
            const userMenuBtn = document.querySelector('[onclick="toggleUserMenu()"]');
            const userMenuDropdown = document.getElementById('user-menu-dropdown');
            
            if (userMenuBtn && userMenuDropdown && 
                !userMenuBtn.contains(event.target) && 
                !userMenuDropdown.contains(event.target)) {
                userMenuDropdown.classList.add('hidden');
            }
        });

        // Global search functionality
        const searchInput = document.getElementById('global-search');
        if (searchInput) {
            searchInput.addEventListener('focus', function() {
                // Implement search suggestions
                console.log('Search focused');
            });
        }

        // Auto-hide flash messages
        setTimeout(() => {
            const flashMessages = document.querySelectorAll('.border-l-4.rounded-xl');
            flashMessages.forEach(message => {
                if (message.classList.contains('bg-green-50') || 
                    message.classList.contains('bg-red-50') || 
                    message.classList.contains('bg-blue-50') || 
                    message.classList.contains('bg-yellow-50') ||
                    message.classList.contains('bg-gray-50')) {
                    message.style.opacity = '0';
                    message.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => message.remove(), 500);
                }
            });
        }, 5000);

        // Handle keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl + / for search
            if (e.ctrlKey && e.key === '/') {
                e.preventDefault();
                const searchInput = document.getElementById('global-search');
                if (searchInput) {
                    searchInput.focus();
                }
            }
            
            // Escape to close dropdowns and mobile menu
            if (e.key === 'Escape') {
                // Close notifications dropdown
                const notificationsDropdown = document.getElementById('notifications-dropdown');
                if (notificationsDropdown) {
                    notificationsDropdown.classList.add('hidden');
                }
                
                // Close user menu dropdown
                const userMenuDropdown = document.getElementById('user-menu-dropdown');
                if (userMenuDropdown) {
                    userMenuDropdown.classList.add('hidden');
                }
                
                // Close mobile menu
                closeMobileMenu();
            }
        });

        // Handle active state for current page
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            
            // Find and activate current page in desktop sidebar
            document.querySelectorAll('.sidebar-item a').forEach(link => {
                const href = link.getAttribute('href');
                if (href && currentPath.includes(href)) {
                    link.parentElement.classList.add('active');
                    
                    // Expand parent submenu if exists
                    const submenu = link.parentElement.querySelector('.sidebar-submenu');
                    if (submenu) {
                        submenu.classList.remove('hidden');
                        const arrow = link.parentElement.querySelector('.fa-chevron-down');
                        if (arrow) arrow.classList.add('rotate-180');
                    }
                }
            });
        });
    </script>
    
    <!-- Additional scripts block for child templates -->
    {% block scripts %}{% endblock %}
</body>
</html>